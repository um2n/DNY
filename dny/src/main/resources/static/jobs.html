<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ê³µê³  ëª©ë¡</title>
</head>
<body>

<h2>ê³µê³  ëª©ë¡</h2>
<ul id="list"></ul>

<script>
    // 1ï¸âƒ£ ë¡œê·¸ì¸ ì—¬ë¶€ í™•ì¸
    fetch("/auth/me", {
        credentials: "include"
    })
    .then(res => res.json())
    .then(isLogin => {

        if (!isLogin) {
            alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            location.href = "/login.html";
            return;
        }

        // 2ï¸âƒ£ DB ê¸°ì¤€ ê³µê³  ì¡°íšŒ
        fetch("/jobs", {
            credentials: "include"
        })
        .then(res => res.json())
        .then(data => {

            const list = document.getElementById("list");
            list.innerHTML = "";

            data.forEach(job => {

                const li = document.createElement("li");

                // ì œëª©
                const title = document.createElement("span");
                title.innerText = job.title + " (" + job.company + ") ";
                li.appendChild(title);

                // ë§ˆê°ì¼
                if (job.deadline) {
                    const deadline = document.createElement("span");
                    deadline.innerText = " [ë§ˆê°: " + job.deadline + "] ";
                    li.appendChild(deadline);
                }

                // ë¶ë§ˆí¬ ë²„íŠ¼
                const btn = document.createElement("button");

                // ğŸ”¥ ì´ˆê¸° ìƒíƒœ ë°˜ì˜
                updateButtonStyle(btn, job.bookmarked);

                btn.onclick = () => {

                    fetch("/bookmark/" + encodeURIComponent(job.jobId), {
                        method: "POST",
                        credentials: "include"
                    })
                    .then(res => res.text())
                    .then(message => {

                        alert(message); // ì„œë²„ ë©”ì‹œì§€ ê·¸ëŒ€ë¡œ ì‚¬ìš©

                        if (message === "ë¶ë§ˆí¬ ì™„ë£Œ") {
                            updateButtonStyle(btn, true);
                        } else if (message === "ë¶ë§ˆí¬ ì·¨ì†Œ") {
                            updateButtonStyle(btn, false);
                        }

                    })
                    .catch(() => {
                        alert("ë¶ë§ˆí¬ ì‹¤íŒ¨");
                    });
                };

                li.appendChild(btn);
                list.appendChild(li);
            });
        });
    });

    // ğŸ”¥ ë²„íŠ¼ ìƒíƒœ ë³€ê²½ í•¨ìˆ˜
    function updateButtonStyle(button, isBookmarked) {

        if (isBookmarked) {
            button.innerText = "â˜… ë¶ë§ˆí¬ë¨";
            button.style.backgroundColor = "#ffd700";
            button.style.color = "black";
        } else {
            button.innerText = "â˜† ë¶ë§ˆí¬";
            button.style.backgroundColor = "";
            button.style.color = "";
        }
    }
</script>


</body>
</html>
